/*! Utterfare 2018-04-27 */
function setImage(a){var b=$("input[name=itemImage]"),c=$("."+a+" input[name=itemImage]").prop("files")[0];$(b).val(),document.getElementsByClassName("item-image");if(c){var d=new FileReader;d.onload=function(b){$("."+a+" .item-image").attr("src",b.target.result)},d.readAsDataURL(c)}return!1}function uploadMenuItems(){return $("#fileupload").trigger("click"),$("#fileupload").change(function(){var a=$(this)[0].files[0];a&&saveMenuItems(a)}),!1}function saveMenuItems(a){var b=new FormData;b.append("action","uploadMenuFile"),b.append("file",a),$.ajax({url:"includes/php/AddEditItems.php",data:b,cache:!1,contentType:!1,processData:!1,method:"post",success:function(a){var b=JSON.parse(a);b.Existing&&(showInformationSnackbar("Items already exist",1e4,"OK"),$.each(b.Existing,function(a,b){$(".error-message").append('<p class="error-text">'+b+" already exists. Try adding an item with a different name or manually enter the item.</p>")})),b.Error&&showInformationSnackbar("Error uploading Items",1e4,"OK"),b.Success&&(showInformationSnackbar("Items sucessfully uploaded",1e4,"OK"),window.location.reload())},error:function(a){console.log("Error: "),console.log(a)}})}function showInformationSnackbar(a,b,c){var d=document.querySelector(".mdl-js-snackbar"),e={message:a,actionHandler:function(a){},actionText:c,timeout:b};d.MaterialSnackbar.showSnackbar(e)}function editItem(a){var b=$("."+a+"-item-name").html(),c=$("."+a+"-item-description").html();return $("."+a).removeAttr("onclick"),$("."+a+"-item-image").append("<input type='file' name='itemImage' value='"+b+"' accept='.png,.jpg,.jpeg,.gif'  onchange='return setImage("+a+");'/>"),$("."+a+"-item-name").html("<input type='text' name='itemName' value='"+b+"' class='itemNameInput'/>"),$("."+a+"-item-description").html("<textarea cols='30' name='itemDescription' class='itemDescriptionInput'>"+c+"</textarea>"),$("."+a).append("<td class='actions'><button onclick='return applyChanges("+a+")'><i class='glyphicon glyphicon-check'></i>Apply</button><br/><button onclick='return deleteItem("+a+")'><i class='glyphicon glyphicon-trash'></i>Delete</button></td>"),!1}function deleteItem(a){if(1==confirm("Are you sure you want to delete that item? This action cannot be undone.")){var b={action:"deleteItem",itemId:a};$.ajax({data:b,url:"includes/php/AddEditItems.php",method:"post",success:function(a){1==a?(getItems(),showSnackbar("Item Successfully Deleted","long")):showSnackbar("Error Removing Item","long")},error:function(a){showSnackbar("Error removing item.","short")}})}}function applyChanges(a){var b=$("input[name='itemImage']").prop("files")[0],c=$('input[name="itemName"]').val(),d=$('textarea[name="itemDescription"]').val(),e={action:"updateItem",ID:a,itemName:c,itemDescription:d};return $.ajax({data:e,url:"includes/php/AddEditItems.php",type:"post",success:function(c){null!==b&&(uploadImage(a,b),showSnackbar("Changes Saved","short"))}}),!1}function getItems(){this.ppp=$("select[name='limit']").val();var a={action:"getItems",limit:ppp,offset:this.offset};$.ajax({url:"includes/php/AddEditItems.php",data:a,method:"post",success:function(a){$(".currentItems__body").html(a),getPagination()}})}function getPagination(){var a={action:"pagination",itemsPerPage:$('select[name="limit"]').val()};$.ajax({data:a,url:"includes/php/AddEditItems.php",method:"POST",success:function(a){$(".table-footer__pagination").html(a)}})}function saveChanges(){var a=[];$(".newItem").each(function(b,c){var d=[];d.ITEM_IMAGE=$(c).find(".item-image").prop("files")[0],d.ITEM_NAME=$(c).find(".item-name").val(),d.ITEM_DESCRIPTION=$(c).find(".item-description").val(),a.push(d)});for(var b=0;b<a.length;b++){var c=a[b],d={action:"addNewItem",itemName:c.ITEM_NAME,itemDescription:c.ITEM_DESCRIPTION};$.ajax({url:"includes/php/AddEditItems.php",data:d,type:"post",success:function(a,b,d){null!=c.ITEM_IMAGE&&uploadImage(a,c.ITEM_IMAGE),getItems()},error:function(a){console.log(a)}})}}function uploadImage(a,b){var c=new FormData;c.append("action","addImage"),c.append("itemID",a),c.append("itemImage",b),$.ajax({url:"includes/php/AddEditItems.php",data:c,cache:!1,contentType:!1,processData:!1,method:"post",success:function(a){getItems()}})}function addItem(a){$(".currentItems__body").prepend("<tr class='newItem' id='"+a+"'><td><input type='file' name='item_image' class='item-image' accept='.png,.jpg,.jpeg,.gif' onchange='return setImage("+a+");'/></td><td><input type='text' name='item_name' class='item-name'/></td><td><textarea name='item_description' class='item-description'></textarea></td></tr>")}function getPage(a){this.offset=this.ppp*(a-1);var b={action:"getItems",limit:ppp,offset:offset};$.ajax({url:"includes/php/AddEditItems.php",data:b,method:"post",success:function(b){$(".currentItems__body").html(b),getPagination();var c=window.location.protocol+"//"+window.location.host+window.location.pathname+"?page="+a;window.history.pushState({path:c},"",c)}})}function setRegistrationPages(a){for(i=1;i<=a;i++){var b=$("fieldset[data-page="+i+"]"),c=$(b).attr("id");$(".page-count").append("<div class='page-count--page-number page-"+i+"' data-page='"+i+"'><a class='registrationPageLink' href='#"+c+"'>"+i+"</div>"),i>1&&i<3&&$(".page-count--page-number").append("<span class='page-count--page-separator'></span>")}location.search;if("true"==$("#contactInformation").attr("active"))$(".page-2").addClass("active");else if("true"==$("#companyInformation").attr("active")){console.log("page 3 active");$(".page-count--page-number").data("page",3);$(".page-3").addClass("active")}else{$(".page-count--page-number").data("page",1);$(".page-1").addClass("active")}}function validatePassword(){var a=$("input[name='password']"),b=$("input[name='confirm_password']"),c=$("button[type='submit']");a.val().length<4?$(a).css("outline","1px solid red"):($(a).css("outline","1px solid green"),a.val()!==b.val()?$(b).css("outline","1px solid red"):($(b).css("outline","1px solid green"),$(c).attr("disabled",!1)))}function registerCompany(){var a="action=registerNewVendor";return a+="&"+$('form[name="registrationform"]').serialize(),$.ajax({data:a,url:"includes/php/VendorRegistration.php",method:"post",success:function(a){"success"===a?window.location.href="userHome.php":"exists"===a?window.location.href="userHome.php":console.log("Response: "+a)}}),!1}function registrationNotification(a){var b="action=registrationNotification";b+="&email="+a,$.ajax({data:b,url:"includes/php/VendorRegistration.php",method:"post",success:function(a){console.log(a)},error:function(a){console.log(a)}})}function validateUsername(a){var b=$('input[name="username"]'),c=$("button[type='submit']"),d={action:"validateUsername",username:a};$.ajax({data:d,url:"includes/php/VendorRegistration.php",method:"post",success:function(a){0==a?($(b).css("outline","1px solid red"),$(c).attr("disabled",!0)):($(b).css("outline","1px solid green"),$(c).attr("disabled",!1))}})}function validateLoginForm(){console.log("validatingForm");var a=$("input[name='username']").val(),b=$("input[name='password']").val(),c=new Array;return""===a||null===a||a.length<5?c.username=!1:c.username=!0,""===b||null===b||b.length<8?c.password=!1:c.password=!0,!1===c.username||!1===c.password?($("input[name='username']").css("outline","1px solid red"),$("input[name='username']").css("border","1px solid red"),$("label[for='username']").css("color","red"),$("input[name='password']").css("outline","1px solid red"),$("input[name='password']").css("border","1px solid red"),$("label[for='password']").css("color","red")):(console.log("signing in"),signIn()),!1}function signIn(){var a=$('form[name="loginForm"]').serialize();console.log(a),$.ajax({url:"includes/php/UserLogIn.php",data:a,method:"post",success:function(a){console.log(a),"success"===a?window.location="userHome.php":console.log("Results: "+a)},error:function(a){console.log("error")}})}function getCompanyInformation(){}function updateCompanyInformation(){var a="action=updateCompanyInformation&";return a+=$("form[name='companyInformation']").serialize(),$.ajax({data:a,method:"post",url:"includes/php/CompanyInformation.php",success:function(a){console.log(a),1==a?showSnackbar("Company Information Updated","long"):showSnackbar("Error: Company Information Was Not Updated","short")},error:function(a){showSnackbar("Error: Company Information Was Not Updated","short")}}),!1}function updateProfilePicture(){var a=$(".profile-picture__upload").prop("files")[0],b=new FormData;return b.append("action","updateProfilePicture"),b.append("picture",a),console.log(a),$.ajax({data:b,type:"post",url:"includes/php/CompanyInformation.php",cache:!1,contentType:!1,processData:!1,success:function(a){$(".profile-picture").attr("src",a+"?ver="+String(Math.random())),$(".profile-picture").css("background-color","transparent"),$(".profile-picture__upload").val(""),showSnackbar("Image successfully uploaded.","long")},error:function(a){showSnackbar("Error uploading image","long")}}),!1}function showSnackbar(a,b){b="long"==b?5e3:"short"==b?3e3:5e3;var c=document.getElementById("snackbar");c.className="show",c.innerHTML=a,setTimeout(function(){c.className=c.className.replace("show")},b),console.log("the watch worked")}function topTermsChart(){var a={action:"getTermsData"};$.ajax({data:a,method:"post",url:"includes/php/SearchAnalytics.php",success:function(a){drawChart("topTermsContainer","Top Search Terms","doughnut",a)},error:function(){console.log("error")}})}function drawChart(a,b,c,d){var e=[],f=[];$.each(JSON.parse(d),function(a,b){e.push(b),f.push(a)}),console.log(e[0]),new CanvasJS.Chart(a,{animation:!0,title:{text:b,horizontalAlignment:"center"},data:[{type:c,startAngle:60,indexLabelFontSize:17,percentFormatString:"#0,##################",indexLabel:"{label}",toolTipContent:"<b>{label}:</b> {y}",dataPoints:[{y:e[0],label:f[0]},{y:e[1],label:f[1]},{y:e[2],label:f[2]},{y:e[3],label:f[3]},{y:e[4],label:f[4]}]}]}).render()}function validateInput(a,b){a.match(/\d+/g),a.match(/^[a-zA-Z\s]+$/);inputValid()}function inputNotValid(){$(".locationInput").css("border","1px solid red"),$(".locationInput").css("outline","1px solid red"),$(".search").prop("disabled",!0)}function inputValid(){$(".locationInput").css("border","1px solid green"),$(".locationInput").css("outline","1px solid green"),$(".search").prop("disabled",!1)}function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}function geolocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(showPosition)}function showPosition(a){codeLatLng(a.coords.latitude,a.coords.longitude)}function codeLatLng(a,b){var c=new google.maps.Geocoder,d=new google.maps.LatLng(a,b);c.geocode({latLng:d},function(a,b){b===google.maps.GeocoderStatus.OK&&a[0]&&($(".locationLink").html("<i class='fa fa-map-marker' aria-hidden='true'></i>"+a[0].formatted_address),$(".locationLink").attr("data-location",a[0].formatted_address))})}function changeLocation(){$(".locationInput").show(),$(".locationLink").hide();var a=$(".locationLink").text().split(","),b=a[1],b=b.split(" ");$(".locationInput").val(a[0]+", "+b[1])}function sendEmail(){var a=$(".contact-form").serialize();return $.ajax({url:"includes/php/contact.php",data:a,method:"post",success:function(a){console.log(a),$(".contact-form").hide(),$(".confirmation").html('<h2 class="confirmation-message">Your email has been received. We will respond within 72 hours.</h2>'),setTimeout(function(){$(".confirmation").hide(),$(".contact-form").show()},2e3)},error:function(a){$(".confirmation").html('<h2 class="error-message">There was an error sending your message. Please try again.</h2>')}}),!1}function authorized(a,b,c){return""!==a&&null!==a&&(!(""===b||null===b||b.length<5)&&(""!==c&&null!==c))}function formSearch(){var a=this.limit,b=this.page,c=this.offset,d=$(".searchInput").val(),e=null;e=$(".locationLink").is(":visible")?$(".locationLink").data("location"):$(".locationInput").val();var f=$(".distance").val();return!0===authorized(d,e,f)?(e=getLatLng(e),console.log(e),performSearch(d,e,f,b,a,c)):(console.log("false"),$(".results").html("Please be sure to fill out the location, distance, and search parameters")),!1}function performSearch(a,b,c,d,e,f){$(".loader").show();var g={location:b,terms:a,limit:e,page:d,distance:c,offset:f};$.ajax({url:"includes/php/search.php",data:g,method:"post",success:function(a){if($(".loader").hide(),"No Results"!==a){var b=$.param(g,!0),c=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+b;window.history.pushState({path:c},"",c),$(".results").html(""),$(".results").append(a),$(".page-title").hide(),$(".navbar-normal").show(),$(".navbar-presearch").hide(),$(".loadmore-button").show()}else $(".results").html("We're afraid that nothing was returned for your search. Please try something else!")},error:function(a,b,c){$(".loader").hide()}})}function loadMore(){this.page+=1;var a=this.limit*this.page,b=this.limit,c=$(".searchInput").val(),d=null;d=$(".locationLink").is(":visible")?$(".locationLink").data("location"):$(".locationInput").val(),performSearch(c,d,$(".distance").val(),page,b,a)}function getLatLng(a){var b=new google.maps.Geocoder,c=a;return b.geocode({address:a},function(a,b){if("OK"===b){console.log(a.geometry.location);var d=a[0].geometry.location.latitude,e=a[0].geometry.location.longitude;c=d+"+"+e,console.log(c)}}),c}var offset="0",page="1",ppp=null;$(document).ready(function(){var a=window.location.pathname,b=1;"/addEditItems.php"!=a&&"/addEditItems"!=a&&"/utterfare/addEditItems"!=a||getItems(),$(".addItemButton").on("click",function(){addItem(b++)}),$(".saveChangesButton").on("click",function(){saveChanges()})}),$(window).on("load",function(){var a=window.location.search;if(a){getPage(a.split("=")[1])}}),$(document).ready(function(){if(document.getElementsByClassName("registrationForm")){setRegistrationPages($(".registrationForm>fieldset").length)}$("#contactInformation").hide(),$("#companyInformation").hide(),$(".next--contact-information").hide(),$(".mdl-textfield__input[name=password]").keyup(function(){$(this).val().length>=8?($(this).css("outline","2px solid green"),$(this).css("border-bottom","2px solid green")):($(this).css("outline","2px solid red"),$(this).css("border-bottom","2px solid red"))}),$(".mdl-textfield__input[name=confirm_password]").keyup(function(){$(this).val()===$(".mdl-textfield__input[name=password]").val()?($(".next--contact-information").fadeIn("fast"),$(this).css("outline","2px solid green"),$(this).css("border-bottom","2px solid green")):($(".next--contact-information").fadeOut("fast"),$(this).css("outline","2px solid red"),$(this).css("border-bottom","2px solid red"))}),$(".page-count--page-number>a").click(function(a){a.preventDefault(),$(this).parent().addClass("active");var b=$(this).attr("href");$(b).attr("id");$(".page-count--page-number").removeClass("active"),$(this).parent().addClass("active"),$(b).attr("active","true"),$("fieldset").each(function(){$(this).attr("id")!==$(b).attr("id")&&$(this).attr("active","false"),"true"==$(this).attr("active")?$(this).fadeIn("slow"):$(this).hide()})}),$(".registrationForm button").click(function(){var a=$(this).data("page"),b=null,c=null;if($(".registrationForm>fieldset").each(function(){var a=$(this).attr("id");$("#"+a).is(":visible")&&(b=a)}),"next"===a){c=$("fieldset:visible").next().attr("data-page");var d=$("#"+b).next();$("#"+b).hide(),$(d[0]).fadeIn("slow"),console.log(d),$(".page-count--page-number").removeClass("active"),$(".page-count--page-number[data-page="+c+"]").addClass("active")}else{c=$("fieldset:visible").prev().attr("data-page");var e=$("#"+b).prev();$("#"+b).hide(),$(e[0]).fadeIn("slow"),$(".page-count--page-number").removeClass("active"),$(".page-count--page-number[data-page="+c+"]").addClass("active")}})});var loginAttempt=0;$(document).ready(function(){}),$(document).ready(function(){topTermsChart()}),$(document).ready(function(){$(".locationInput").hide(),$(".locationLink").html("Finding Location..."),$(".locationInput").on("keyup",function(a){validateInput($(this).val(),a)}),locationLink=$(".locationLink"),geolocation()}),$(document).ready(function(){$(".uf-textfield__input").on("focusin",function(){$(this).parent().addClass("is-focused")}),$(".uf-textfield__input").on("focusout",function(){null!=$(this).val()&&""!=$(this).val().trim()||$(this).parent().removeClass("is-focused")})});var limit=25,page=1,offset="0";$(document).ready(function(){$(".loadmore-button").hide(),$(".navbar-normal").hide(),$(window).on("load",function(){if(window.location.search){var a=window.location.search.split("&"),b=new Array;$.each(a,function(a,c){var d=decodeURIComponent(c.split("=")[1]);b.push(d)});var c=getLatLng(b[0]),d=b[1],e=b[2],f=b[3],g=b[4],h=(b[5],e*f);$(".searchInput").val(d),performSearch(d,c,g,f,h,0)}})}),$(window).on("unload",function(){if("/utterfare/"===window.location.pathname){$(".searchInput").val();$(".locationLink").is(":visible")?$(".locationLink").data("location"):$(".locationInput").val();$(".distance").val()}});